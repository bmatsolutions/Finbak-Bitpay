@model ReportDataModel
@{
    Layout = "_LayoutReport";
    var reportData = Model.DataList as IEnumerable<GeneralReportData>;
    var totals = reportData.Sum(x => x.Amount);

    //---- Get groups
    var groups = (from data in reportData
                  group data by data.ModeCode into grp
                  select new ReportGroupData
                  {
                      paymentmode = grp.FirstOrDefault().PaymentMode,
                      GroupCode = grp.FirstOrDefault().ModeCode,
                      GroupAmount = grp.Sum(x => x.Amount)

                  });
    bool authenticated = false;
    string userId = "";
    UserDataModel currentUserData = null;
    int userRole = -1;
    string title = "";
    int posttocbs = -1;
    if (User.Identities.Any(u => u.IsAuthenticated))
    {
        authenticated = true;
        currentUserData = Util.GetCurrentUserData(User.Identities);
        if (currentUserData != null)
        {
            userRole = currentUserData.UserRole;
            title = currentUserData.Title;
            posttocbs = currentUserData.Post;
        }
    }
}

    <div class="table-responsive">
        <div class="text-center">@Model.Title</div>
        <div style="font-size:12px;">Dates: @Model.DateRange</div>
        <hr />
        <table class="table table-striped table-bordered table-responsive-sm nowrap" id="Data" style="width:100%">
            <thead>
                <tr>
                    <th class="header">Txn Ref</th>
                    <th class="header">Cr Acc</th>
                    <th class="header">Dr Acc</th>
                    <th class="header">Amount</th>
                    <th class="header">Date</th>
                    <th class="header">Maker Id</th>
                    @if (posttocbs == 1)
                    {
                        <th class="header">Checker Id</th>
                    }
                    <th class="header">Office Code</th>
                    <th class="header">Company Code</th>
                    <th class="header">Receipt Number</th>
                    @*<th class="header">Decl ref</th>*@
                    <th class="header">Decl Code</th>
                    <th class="header">Reason</th>
                    <th class="header">Cbs Response</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var g in groups)
                {
                    @*<tr>
                    <th colspan="5">@g.paymentmode</th>
                </tr>*@

                    @foreach (var rec in reportData.Where(x => x.ModeCode == g.GroupCode))
                    {
                <tr>
                    <td>@rec.CbsResp</td>
                    <td>@rec.CR_Account</td>
                    <td>@rec.DR_Account</td>
                    <td>@rec.Amount.ToString("#,##0.00")</td>
                    <td>@rec.PaymentDate.ToString("dd/MM/yyyy")</td>
                    <td>@rec.MakerID</td>
                    @if (posttocbs == 1)
                    {
                        <td>@rec.Checker_Id</td>
                    }
                    <td>@rec.OfficeCode</td>
                    <td>@rec.CompanyCode</td>
                    <td>@rec.ReceiptNo</td>
                    @*<td>@rec.DeclarantRef</td>*@
                    <td>@rec.DeclarantNo</td>
                    <td>@rec.Reason</td>
                    <td>@rec.CbsResp</td>
                </tr>

                    }
                    @*<tr>
                    <th class="group-header" colspan="5">Group Totals:</th>
                    <th class="group-header text-right">@g.GroupAmount.ToString("#,##0.00")</th>
                </tr>*@

                }
            <tfoot>
                <tr>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    @if (posttocbs == 1)
                    {
                        <th></th>
                    }
                    <th></th>
                    <th></th>
                    <th></th>
                    <th>General Totals:</th>
                    <th class="text-right">@totals.ToString("#,##0.00")</th>
                </tr>
            </tfoot>
            </tbody>
        </table>
        @*<table class="table-report report-footer">
            <tr>
                <th>General Totals:</th>
                <th class="text-right">@totals.ToString("#,##0.00")</th>
            </tr>
        </table>*@
    </div>
   
    <script>
    $(document).ready(function () {
        var d = new Date();
        var n = d.toString();
        $('#Data').DataTable({
            dom: 'Bfrtip',
            buttons: [
                {
                    extend: 'excel',
                    messageTop: 'Failed Payment Report',
                    messageBottom: 'Print Date   :  ' + n,
                    title: '@title',
                    footer: true
                },
                {
                    extend: 'pdf',
                    messageTop: 'Failed Payment Report',
                    messageBottom: 'Print Date   :  ' + n ,
                    title: '@title',
                    orientation: 'landscape',
                    pageSize: 'A4',
                    footer: true
                },
            ]
        });
    });
    </script>